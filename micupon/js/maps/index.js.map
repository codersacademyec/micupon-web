{"version":3,"sources":["indexService.js","indexCtrl.js"],"names":["indexService","globalService","socialProvider","login","i","Stamplay","User","socialLogin","getItems","filtro","Object","get","then","res","data","updateItem","item","update","err","deleteItem","remove","saveItem","code","save","usuario","codigo","addAlert","service","busqueda","modificar","eliminar","nuevo","indexCtrl","$scope","$rootScope","AccountService","$modal","vm","this","cupones","showFiltros","showNuevo","filtros","itemSeleccionado","modalEliminar","scope","template","html","show","animation","tableConfig","itemsPerPage","fillLastPage","ingresar","ocultarSide","buscar","$apply","$promise","confirmarElim","hide","guardar","limpiarFiltros","currentUser","user","owner","_id","perfil","angular","module","factory","controller"],"mappings":"AAEA,QAAAA,cAAAC,EAAAC,GAUA,QAAAC,GAAAC,GACAC,SAAAC,KAAAC,YAAAL,EAAAE,IAGA,QAAAI,GAAAC,GACA,MAAAJ,UAAAK,OAAA,WAAAC,IAAAF,GACAG,KAAA,SAAAC,GACA,MAAAA,GAAAC,OAIA,QAAAC,GAAAC,GACAX,SAAAK,OAAA,WAAAO,OAAA,SAAAD,GACAJ,KAAA,SAAAC,KAEA,SAAAK,MAKA,QAAAC,GAAAH,GACAX,SAAAK,OAAA,WAAAU,OAAA,UACAR,KAAA,SAAAC,KAEA,SAAAK,MAKA,QAAAG,GAAAC,GAEAjB,SAAAK,OAAA,oBAAAa,MAAAC,QAAA,2BAAAC,OAAAH,IACAV,KAAA,SAAAC,GACAa,YACA,SAAAR,MA3CA,GAAAS,IACAC,SAAApB,EACAqB,UAAAd,EACAe,SAAAX,EACAY,MAAAV,EACAlB,MAAAA,EAGA,OAAAwB,GCTA,QAAAK,WAAAC,EAAAC,EAAAjC,EAAAD,EAAAmC,EAAAC,GACA,GAAAC,GAAAC,IACAD,GAAApC,cAAAA,EACAoC,EAAAE,WACAF,EAAAG,aAAA,EACAH,EAAAI,WAAA,EACAJ,EAAAK,WACAL,EAAAN,SACAM,EAAAM,oBACAN,EAAAO,cAAAR,GACAS,MAAAZ,EACAa,SAAA,ybACAC,MAAA,EACAC,MAAA,EACAC,UAAA,iBAEAZ,EAAAa,aACAC,aAAA,EACAC,cAAA,GAGAf,EAAAgB,SAAA,SAAAjD,GACAJ,EAAAG,MAAAC,IAGAiC,EAAAiB,YAAA,WACAjB,EAAAG,aAAA,EACAH,EAAAI,WAAA,GAGAJ,EAAAkB,OAAA,WACAvD,EAAA4B,SAAAS,EAAAK,SAAA9B,KAAA,SAAAE,GACAuB,EAAAE,QAAAzB,EACAuB,EAAAG,aAAA,EACAP,EAAAuB,YAIAnB,EAAAP,SAAA,SAAAd,GACAqB,EAAAM,iBAAA3B,EACAqB,EAAAO,cAAAa,SAAA7C,KAAAyB,EAAAO,cAAAI,OAGAX,EAAAqB,cAAA,WACA1D,EAAA8B,SAAAO,EAAAM,kBAAA/B,KAAA,SAAAE,GACAuB,EAAAO,cAAAa,SAAA7C,KAAAyB,EAAAO,cAAAe,SAIAtB,EAAAuB,QAAA,SAAA5C,GACAhB,EAAA+B,MAAAf,IAGAqB,EAAAwB,eAAA,WACAxB,EAAAK,YAGAL,EAAAkB,SACApB,EAAA2B,cACAlD,KAAA,SAAAmD,IACAA,GAAA7B,EAAA6B,QACA7B,EAAA6B,KAAAA,EAAAA,EAAA7B,EAAA6B,KACA1D,SAAAK,OAAA,YAAAC,KACAqD,MAAA9B,EAAA6B,KAAAE,MAEArD,KAAA,SAAAC,GACAqB,EAAA6B,KAAAG,OAAArD,EAAAC,KAAA,IACA,SAAAI,SDrEAiD,QAAAC,OAAA,WAAAC,QAAA,gBAAA,gBAAA,iBAAArE,eCAAmE,QAAAC,OAAA,WAAAE,WAAA,aAAA,SAAA,aAAA,gBAAA,eAAA,iBAAA,SAAAtC","file":"../index.js","sourcesContent":["angular.module('micupon').factory('indexService', ['globalService','socialProvider',indexService]);\n\nfunction indexService(globalService,socialProvider) {\n    var service = {\n        busqueda: getItems,\n        modificar: updateItem,\n        eliminar: deleteItem,\n        nuevo: saveItem,\n        login: login\n    };\n\n    return service;\n    function login(i){\n        Stamplay.User.socialLogin(socialProvider[i]);    \n    }\n    \n    function getItems(filtro) {\n        return Stamplay.Object(\"cupones\").get(filtro)\n        .then(function(res) {\n          return res.data;\n        }); \n    }\n\n    function updateItem(item){\n       Stamplay.Object(\"cupones\").update(\"codigo\",item)\n        .then(function(res) {\n          // success\n        }, function(err) {\n          // error\n        }) \n    }\n\n    function deleteItem(item){\n       Stamplay.Object(\"cupones\").remove(\"codigo\")\n        .then(function(res) {\n          // success\n        }, function(err) {\n          // error\n        }) \n    }\n\n    function saveItem(code){\n\n        Stamplay.Object(\"cupones_usuarios\").save({usuario:'57feba3ca3b12b294d4891c0',codigo:code})\n        .then(function(res) {\n           addAlert();\n        }, function(err) {\n            // TODO MOSTRAR ERROR\n        })       \n    }\n\n\n}","angular.module('micupon').controller('indexCtrl', ['$scope', '$rootScope', 'globalService', 'indexService', 'AccountService', '$modal', indexCtrl]);\n\nfunction indexCtrl($scope, $rootScope, globalService, indexService, AccountService, $modal) {\n    var vm = this;\n    vm.globalService = globalService;\n    vm.cupones = [];\n    vm.showFiltros = false;\n    vm.showNuevo = false;\n    vm.filtros = {};\n    vm.nuevo = {};\n    vm.itemSeleccionado = {};\n    vm.modalEliminar = $modal({\n        scope: $scope,\n        template: '<div class=\"modal\"><div class=\"modal-dialog\" role=\"document\"><div class=\"modal-content\"><div class=\"modal-header\"><h4 class=\"modal-title\">Eliminar la banda horaria con id {{ctrl.bandaSeleccionada.id}}?</h4></div><div class=\"modal-footer\"><button type=\"button\" class=\"btn btn-default\" ng-click=\"$hide()\">Cancelar</button><button type=\"button\" class=\"btn btn-danger\" ng-click=\"ctrl.confirmarElim()\">Eliminar</button></div></div></div></div>',\n        html: true,\n        show: false,\n        animation: 'am-slide-top'\n    });\n    vm.tableConfig = {\n        itemsPerPage: 5,\n        fillLastPage: true\n    };\n\n    vm.ingresar = function(i) {\n        indexService.login(i);\n    };\n\n    vm.ocultarSide = function() {\n        vm.showFiltros = false;\n        vm.showNuevo = false;\n    };\n\n    vm.buscar = function() {\n        indexService.busqueda(vm.filtros).then(function(data) {\n            vm.cupones = data;\n            vm.showFiltros = false;\n            $scope.$apply();\n        });\n    };\n\n    vm.eliminar = function(item) {\n        vm.itemSeleccionado = item;\n        vm.modalEliminar.$promise.then(vm.modalEliminar.show);\n    };\n\n    vm.confirmarElim = function() {\n        indexService.eliminar(vm.itemSeleccionado).then(function(data) {\n            vm.modalEliminar.$promise.then(vm.modalEliminar.hide);\n        });\n    };\n\n    vm.guardar = function(item) {\n        indexService.nuevo(item);\n    };\n\n    vm.limpiarFiltros = function() {\n        vm.filtros = {};\n    };\n\n    vm.buscar();\n    AccountService.currentUser()\n        .then(function(user) {\n            if (user || $rootScope.user) {\n                $rootScope.user = user ? user : $rootScope.user;\n                Stamplay.Object(\"usuarios\").get({\n                        owner: $rootScope.user._id\n                    })\n                    .then(function(res) {\n                        $rootScope.user.perfil = res.data[0];\n                    }, function(err) {\n                        // Error\n                    });\n            }\n        });\n}"]}