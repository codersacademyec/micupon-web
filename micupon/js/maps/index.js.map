{"version":3,"sources":["indexService.js","indexCtrl.js"],"names":["indexService","globalService","socialProvider","login","i","Stamplay","User","socialLogin","getItems","filtro","user","Object","get","then","res","data","length","usuario","_id","codigo","disable","err","updateItem","item","update","deleteItem","remove","response","saveItem","code","save","sendPush","perfil","push_token","addAlert","service","busqueda","modificar","eliminar","nuevo","indexCtrl","$scope","$rootScope","AccountService","$modal","vm","this","cupones","showFiltros","showNuevo","filtros","itemSeleccionado","modalEliminar","scope","template","html","show","animation","tableConfig","itemsPerPage","fillLastPage","ingresar","ocultarSide","buscar","$apply","$promise","confirmarElim","hide","guardar","$","modal","limpiarFiltros","currentUser","owner","angular","module","factory","controller"],"mappings":"AAEA,QAAAA,cAAAC,EAAAC,GAUA,QAAAC,GAAAC,GACAC,SAAAC,KAAAC,YAAAL,EAAAE,IAGA,QAAAI,GAAAC,EAAAC,GACA,MAAAL,UAAAM,OAAA,WAAAC,IAAAH,GACAI,KAAA,SAAAC,GACA,GAAAA,EAAAC,KACA,IAAA,GAAAX,GAAAU,EAAAC,KAAAC,OAAA,EAAAZ,GAAA,EAAAA,IACAM,EACAL,SAAAM,OAAA,oBAAAC,KAAAK,QAAAP,EAAAQ,IAAAC,OAAAL,EAAAC,KAAAX,GAAAe,SACAN,KAAA,SAAAC,GACAA,EACAA,EAAAC,KAAAX,GAAAgB,SAAA,EAEAN,EAAAC,KAAAX,GAAAgB,SAAA,GAEA,SAAAC,MAIAP,EAAAC,KAAAX,GAAAgB,SAAA,CAIA,OAAAN,GAAAC,OAIA,QAAAO,GAAAC,GACAlB,SAAAM,OAAA,WAAAa,OAAA,SAAAD,GACAV,KAAA,SAAAC,KAEA,SAAAO,MAKA,QAAAI,GAAAF,GACAlB,SAAAM,OAAA,WAAAe,OAAA,UACAb,KAAA,SAAAc,KAEA,SAAAN,MAKA,QAAAO,GAAAC,EAAAnB,GACAL,SAAAM,OAAA,oBAAAmB,MAAAb,QAAAP,EAAAQ,IAAAC,OAAAU,IACAhB,KAAA,SAAAC,GACAb,EAAA8B,SAAArB,EAAAsB,OAAAC,WAAA,wCACAC,YACA,SAAAb,MA7DA,GAAAc,IACAC,SAAA5B,EACA6B,UAAAf,EACAgB,SAAAb,EACAc,MAAAX,EACAzB,MAAAA,EAGA,OAAAgC,GCTA,QAAAK,WAAAC,EAAAC,EAAAzC,EAAAD,EAAA2C,EAAAC,GACA,GAAAC,GAAAC,IACAD,GAAA5C,cAAAA,EACA4C,EAAAE,WACAF,EAAAG,aAAA,EACAH,EAAAI,WAAA,EACAJ,EAAAK,WACAL,EAAAN,SACAM,EAAAM,oBAEAN,EAAAO,cAAAR,GACAS,MAAAZ,EACAa,SAAA,ybACAC,MAAA,EACAC,MAAA,EACAC,UAAA,iBAGAZ,EAAAa,aACAC,aAAA,EACAC,cAAA,GAGAf,EAAAgB,SAAA,SAAAzD,GACAJ,EAAAG,MAAAC,IAGAyC,EAAAiB,YAAA,WACAjB,EAAAG,aAAA,EACAH,EAAAI,WAAA,GAGAJ,EAAAkB,OAAA,WACA/D,EAAAoC,SAAAS,EAAAK,QAAAR,EAAAhC,MAAAG,KAAA,SAAAE,GACA8B,EAAAE,QAAAhC,EACA8B,EAAAG,aAAA,EACAP,EAAAuB,YAIAnB,EAAAP,SAAA,SAAAf,GACAsB,EAAAM,iBAAA5B,EACAsB,EAAAO,cAAAa,SAAApD,KAAAgC,EAAAO,cAAAI,OAGAX,EAAAqB,cAAA,WACAlE,EAAAsC,SAAAO,EAAAM,kBAAAtC,KAAA,SAAAE,GACA8B,EAAAO,cAAAa,SAAApD,KAAAgC,EAAAO,cAAAe,SAIAtB,EAAAuB,QAAA,SAAA7C,GACAmB,EAAAhC,KAIAV,EAAAuC,MAAAhB,EAAAmB,EAAAhC,MAHA2D,EAAA,iBAAAC,SAOAzB,EAAA0B,eAAA,WACA1B,EAAAK,YAIAL,EAAAkB,SAEApB,EAAA6B,cACA3D,KAAA,SAAAH,IACAA,GAAAgC,EAAAhC,QACAgC,EAAAhC,KAAAA,EAAAA,EAAAgC,EAAAhC,KACAL,SAAAM,OAAA,YAAAC,KACA6D,MAAA/B,EAAAhC,KAAAQ,MAEAL,KAAA,SAAAC,GACA4B,EAAAhC,KAAAsB,OAAAlB,EAAAC,KAAA,IACA,SAAAM,SD9EAqD,QAAAC,OAAA,WAAAC,QAAA,gBAAA,gBAAA,iBAAA5E,eCAA0E,QAAAC,OAAA,WAAAE,WAAA,aAAA,SAAA,aAAA,gBAAA,eAAA,iBAAA,SAAArC","file":"../index.js","sourcesContent":["angular.module('micupon').factory('indexService', ['globalService','socialProvider',indexService]);\r\n\r\nfunction indexService(globalService,socialProvider) {\r\n    var service = {\r\n        busqueda: getItems,\r\n        modificar: updateItem,\r\n        eliminar: deleteItem,\r\n        nuevo: saveItem,\r\n        login: login\r\n    };\r\n\r\n    return service;\r\n    function login(i){\r\n        Stamplay.User.socialLogin(socialProvider[i]);    \r\n    }\r\n    \r\n    function getItems(filtro, user) {\r\n        return Stamplay.Object(\"cupones\").get(filtro)\r\n        .then(function(res) {\r\n            if(res.data){\r\n                for (var i = res.data.length - 1; i >= 0; i--) {\r\n                    if(user){\r\n                        Stamplay.Object(\"cupones_usuarios\").get({usuario:user._id,codigo:res.data[i].codigo})\r\n                        .then(function(res) {\r\n                            if(res){\r\n                                res.data[i].disable = true;\r\n                            }else{\r\n                                res.data[i].disable = false;\r\n                            }\r\n                        }, function(err) {\r\n                            // TODO MOSTRAR ERROR\r\n                        })\r\n                    } else{\r\n                        res.data[i].disable = false;\r\n                    }             \r\n                }                \r\n            }\r\n          return res.data;\r\n        }); \r\n    }\r\n\r\n    function updateItem(item){\r\n       Stamplay.Object(\"cupones\").update(\"codigo\",item)\r\n        .then(function(res) {\r\n          // success\r\n        }, function(err) {\r\n          // error\r\n        }) \r\n    }\r\n\r\n    function deleteItem(item){\r\n       Stamplay.Object(\"cupones\").remove(\"codigo\")\r\n        .then(function(response) {\r\n            // success\r\n        }, function(err) {\r\n          // error\r\n        }) \r\n    }\r\n\r\n    function saveItem(code, user){\r\n        Stamplay.Object(\"cupones_usuarios\").save({usuario:user._id,codigo:code})\r\n        .then(function(res) {\r\n            globalService.sendPush(user.perfil.push_token,'El cup√≥n ha sido enviado a su movil.');\r\n            addAlert();\r\n        }, function(err) {\r\n            // TODO MOSTRAR ERROR\r\n        })       \r\n    }\r\n\r\n    \r\n}","angular.module('micupon').controller('indexCtrl', ['$scope', '$rootScope', 'globalService', 'indexService', 'AccountService', '$modal', indexCtrl]);\r\n\r\nfunction indexCtrl($scope, $rootScope, globalService, indexService, AccountService, $modal) {\r\n    var vm = this;\r\n    vm.globalService = globalService;\r\n    vm.cupones = [];\r\n    vm.showFiltros = false;\r\n    vm.showNuevo = false;\r\n    vm.filtros = {};\r\n    vm.nuevo = {};\r\n    vm.itemSeleccionado = {};\r\n\r\n    vm.modalEliminar = $modal({\r\n        scope: $scope,\r\n        template: '<div class=\"modal\"><div class=\"modal-dialog\" role=\"document\"><div class=\"modal-content\"><div class=\"modal-header\"><h4 class=\"modal-title\">Eliminar la banda horaria con id {{ctrl.bandaSeleccionada.id}}?</h4></div><div class=\"modal-footer\"><button type=\"button\" class=\"btn btn-default\" ng-click=\"$hide()\">Cancelar</button><button type=\"button\" class=\"btn btn-danger\" ng-click=\"ctrl.confirmarElim()\">Eliminar</button></div></div></div></div>',\r\n        html: true,\r\n        show: false,\r\n        animation: 'am-slide-top'\r\n    });\r\n\r\n    vm.tableConfig = {\r\n        itemsPerPage: 5,\r\n        fillLastPage: true\r\n    };\r\n\r\n    vm.ingresar = function(i) {\r\n        indexService.login(i);\r\n    };\r\n\r\n    vm.ocultarSide = function() {\r\n        vm.showFiltros = false;\r\n        vm.showNuevo = false;\r\n    };\r\n\r\n    vm.buscar = function() {\r\n        indexService.busqueda(vm.filtros, $rootScope.user).then(function(data) {\r\n            vm.cupones = data;\r\n            vm.showFiltros = false;\r\n            $scope.$apply();\r\n        });\r\n    };\r\n\r\n    vm.eliminar = function(item) {\r\n        vm.itemSeleccionado = item;\r\n        vm.modalEliminar.$promise.then(vm.modalEliminar.show);\r\n    };\r\n\r\n    vm.confirmarElim = function() {\r\n        indexService.eliminar(vm.itemSeleccionado).then(function(data) {\r\n            vm.modalEliminar.$promise.then(vm.modalEliminar.hide);\r\n        });\r\n    };\r\n\r\n    vm.guardar = function(item) {\r\n        if(!$rootScope.user){\r\n            $('#login-dialog').modal();\r\n        }\r\n        else{\r\n            indexService.nuevo(item,$rootScope.user);\r\n        }\r\n    };\r\n\r\n    vm.limpiarFiltros = function() {\r\n        vm.filtros = {};\r\n    };\r\n\r\n\r\n    vm.buscar();\r\n    \r\n    AccountService.currentUser()\r\n        .then(function(user) {\r\n            if (user || $rootScope.user) {\r\n                $rootScope.user = user ? user : $rootScope.user;\r\n                Stamplay.Object(\"usuarios\").get({\r\n                        owner: $rootScope.user._id\r\n                    })\r\n                    .then(function(res) {\r\n                        $rootScope.user.perfil = res.data[0];\r\n                    }, function(err) {\r\n                        // Error\r\n                    });\r\n            }\r\n        });\r\n}"]}