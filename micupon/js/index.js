function indexService(n,o){function i(n){Stamplay.User.socialLogin(o[n])}function t(n,o){return Stamplay.Object("cupones").get(n).then(function(n){if(n.data){cupones=[];for(var i=n.data.length-1;i>=0;i--)cupon=n.data[i],cupon.flag=!1,o&&Stamplay.Object("cupones_usuarios").get({usuario:o._id}).then(function(n){if(n)for(var o=n.data.length-1;o>=0;o--)for(var i=n.data[o].codigos.length-1;i>=0;i--)cupon._id==n.data[o].codigos[i]&&(cupon.flag=!0)},function(n){}),cupones.push(cupon)}return n.data=cupones,n.data},function(n){})}function e(n){Stamplay.Object("cupones").patch("codigo",n).then(function(n){},function(n){})}function a(n){Stamplay.Object("cupones").remove("codigo").then(function(n){},function(n){})}function c(n,o){Stamplay.Object("cupones_usuarios").get({usuario:o._id}).then(function(i){i&&i.length>0?(i.codigos.push(n),Stamplay.Object("cupones_usuarios").patch({usuario:o._id,codigos:i.codigos}).then(function(n){u(o)},function(n){})):Stamplay.Object("cupones_usuarios").save({usuario:o._id,codigos:n}).then(function(n){u(o)},function(n){})},function(n){})}function u(o){n.sendPush(o.perfil.push_token,"El cup√≥n ha sido enviado a su movil."),addAlert()}var l={busqueda:t,modificar:e,eliminar:a,nuevo:c,login:i};return l}function indexCtrl(n,o,i,t,e,a){var c=this;c.globalService=i,c.cupones=[],c.showFiltros=!1,c.showNuevo=!1,c.filtros={},c.nuevo={},c.itemSeleccionado={},e.currentUser().then(function(n){(n||o.user)&&(o.user=n?n:o.user,Stamplay.Object("usuarios").get({owner:o.user._id}).then(function(n){o.user.perfil=n.data[0]},function(n){}))}),c.modalEliminar=a({scope:n,template:'<div class="modal"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">Eliminar la banda horaria con id {{ctrl.bandaSeleccionada.id}}?</h4></div><div class="modal-footer"><button type="button" class="btn btn-default" ng-click="$hide()">Cancelar</button><button type="button" class="btn btn-danger" ng-click="ctrl.confirmarElim()">Eliminar</button></div></div></div></div>',html:!0,show:!1,animation:"am-slide-top"}),c.tableConfig={itemsPerPage:5,fillLastPage:!0},c.ingresar=function(n){t.login(n)},c.ocultarSide=function(){c.showFiltros=!1,c.showNuevo=!1},c.buscar=function(){t.busqueda(c.filtros,o.user).then(function(o){c.cupones=o,c.showFiltros=!1,n.$apply()})},c.eliminar=function(n){c.itemSeleccionado=n,c.modalEliminar.$promise.then(c.modalEliminar.show)},c.confirmarElim=function(){t.eliminar(c.itemSeleccionado).then(function(n){c.modalEliminar.$promise.then(c.modalEliminar.hide)})},c.guardar=function(n){o.user?t.nuevo(n,o.user):$("#login-dialog").modal()},c.limpiarFiltros=function(){c.filtros={}},c.buscar()}angular.module("micupon").factory("indexService",["globalService","socialProvider",indexService]),angular.module("micupon").controller("indexCtrl",["$scope","$rootScope","globalService","indexService","AccountService","$modal",indexCtrl]);
//# sourceMappingURL=maps/index.js.map
