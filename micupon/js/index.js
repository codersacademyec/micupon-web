function indexService(o,n){function i(o){Stamplay.User.socialLogin(n[o])}function e(o,n){var i={filtro:o};n&&(i={user:{_id:n._id,perfil:n.perfil},filtro:o});var e=new Stamplay.Codeblock("cuponespersonas");return e.run(i).then(function(o){return o},function(o){return console.error(o),null})}function t(o){Stamplay.Object("cupones").patch("codigo",o).then(function(o){},function(o){console.log(o)})}function a(o){Stamplay.Object("cupones").remove("codigo").then(function(o){},function(o){console.log(o)})}function l(o,n){Stamplay.Object("cupones_usuarios").get({usuario:n.perfil.id}).then(function(i){if(i.data&&i.data.length>0)i.data[0].codigos.push(o),console.log(i.data[0].codigos),Stamplay.Object("cupones_usuarios").update(i.data[0].id,i.data[0]).then(function(o){c(n)},function(o){console.log(o)});else{var e={usuario:[n.perfil.id],codigos:[o]};Stamplay.Object("cupones_usuarios").save(e).then(function(o){c(n)},function(o){console.log(o)})}},function(o){console.log(o)})}function c(n){o.sendPush(n.perfil.push_token,"El cup√≥n ha sido enviado a su movil."),addAlert()}var r={busqueda:e,modificar:t,eliminar:a,nuevo:l,login:i};return r}function indexCtrl(o,n,i,e,t,a){var l=this;l.globalService=i,l.cupones=[],l.showFiltros=!1,l.showNuevo=!1,l.filtros={},l.nuevo={},l.itemSeleccionado={},t.currentUser().then(function(o){o||n.user?(n.user=o?o:n.user,Stamplay.Object("usuarios").get({owner:n.user._id}).then(function(o){n.user.perfil=o.data[0],l.buscar()},function(o){console.log(o)})):l.buscar()}),l.modalEliminar=a({scope:o,template:'<div class="modal"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">Eliminar la banda horaria con id {{ctrl.bandaSeleccionada.id}}?</h4></div><div class="modal-footer"><button type="button" class="btn btn-default" ng-click="$hide()">Cancelar</button><button type="button" class="btn btn-danger" ng-click="ctrl.confirmarElim()">Eliminar</button></div></div></div></div>',html:!0,show:!1,animation:"am-slide-top"}),l.tableConfig={itemsPerPage:5,fillLastPage:!0},l.ingresar=function(o){e.login(o)},l.ocultarSide=function(){l.showFiltros=!1,l.showNuevo=!1},l.buscar=function(){e.busqueda(l.filtros,n.user).then(function(n){l.cupones=n,l.showFiltros=!1,o.$digest(),console.log(n)})},l.eliminar=function(o){l.itemSeleccionado=o,l.modalEliminar.$promise.then(l.modalEliminar.show)},l.confirmarElim=function(){e.eliminar(l.itemSeleccionado).then(function(o){l.modalEliminar.$promise.then(l.modalEliminar.hide)})},l.guardar=function(o){n.user?(e.nuevo(o._id,n.user),o.flag=!0):$("#login-dialog").modal()},l.limpiarFiltros=function(){l.filtros={}}}angular.module("micupon").factory("indexService",["globalService","socialProvider",indexService]),angular.module("micupon").controller("indexCtrl",["$scope","$rootScope","globalService","indexService","AccountService","$modal",indexCtrl]);
//# sourceMappingURL=maps/index.js.map
